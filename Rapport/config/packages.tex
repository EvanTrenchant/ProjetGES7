% =====================================
% CONFIGURATION DES PACKAGES ET COULEURS
% =====================================

% --- Encodage et langue ---
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}
\usepackage[gen]{eurosym}
% \renewcommand{\familydefault}{\sfdefault}  % Utilise Computer Modern Sans Serif (désactivé)
% \renewcommand{\sfdefault}{qag}  % Spécifie cmss comme police sans empattement (désactivé)

% --- Polices personnalisées (Page de garde) ---
% Décommentez celle que vous préférez ou ajoutez-en d'autres
%\usepackage{lmodern} % Police standard de haute qualité
\usepackage[scale=0.95]{tgheros} % Clone de Helvetica (très propre, sans serif)
% \usepackage{raleway} % Police moderne et fine (si installée)
% \usepackage{roboto}  % Police géométrique (si installée)

% --- Packages pour la mise en page et le contenu ---
\usepackage{graphicx}               % Pour inclure des images
\usepackage[a4paper]{geometry} % Gestion des marges
% Configuration des marges ET des espaces pour l'en-tête/pied de page
\geometry{
  left=2cm,        % Marge gauche (augmentez pour "agrandir")
  right=2cm,       % Marge droite (augmentez pour "agrandir")
  top=2.5cm,         % Marge haute (augmentez pour "agrandir")
  bottom=1.5cm,      % Marge basse (augmentez pour "agrandir")
  headheight=34pt, % Indique à geometry la taille de votre en-tête fancyhdr
  footskip=24pt,    % Indique à geometry l'espace pour votre pied de page
  headsep=0.5cm
}
\usepackage{amsmath, amssymb}       % Outils mathématiques avancés
\usepackage[
    hidelinks,
    pdftitle={TRENCHANT\_TROULLIER\_VIRQUIN\_GES7\_Projet},
    pdfauthor={TRENCHANT Evan, TROULLIER Laël, VIRQUIN Rudy},
    pdfsubject={Projet GE S7},
    pdfkeywords={génie électrique, projet S7, INSA Strasbourg, GES7},
    pdfcreator={LaTeX},
    pdfproducer={LaTeX}
]{hyperref}    % Pour les liens cliquables et métadonnées PDF
\usepackage{fancyhdr}               % Pour personnaliser les en-têtes et pieds de page
\usepackage{xcolor}                 % Pour utiliser des couleurs
\usepackage{tcolorbox}              % Pour créer des boîtes colorées
\usepackage{float}                  % Pour mieux placer les figures
\usepackage{caption}                % Pour personnaliser les légendes
\usepackage{subcaption}             % Pour des sous-figures
\usepackage{booktabs}               % Pour de jolis tableaux
\usepackage{newfloat}               % Pour créer de nouveaux types de flottants
\usepackage{titlesec}               % Pour personnaliser les titres de chapitres
\usepackage{lastpage}               % Pour obtenir le nombre total de pages
\usepackage{datetime}               % Pour le formatage des dates
\usepackage{pgfgantt}           % Diagrammes de Gantt
\usepackage{pdflscape}          % Pour changer l'orientation des pages PDF
\usepackage{rotating}             % Pour les figures en mode paysage (sidewaysfigure)
\usepackage{enumitem}               % Pour personnaliser les listes

% --- Configuration des listes ---
\setlist[itemize,1]{label=\textbullet}    % Premier niveau : bullet standard
\setlist[itemize,2]{label=\textendash}    % Deuxième niveau : tiret
\setlist[itemize,3]{label=$\ast$}         % Troisième niveau : astérisque
\setlist[itemize,4]{label=$\cdot$}        % Quatrième niveau : point centré

% Configuration de la table des matières (exclut les subsections)
\setcounter{tocdepth}{1}  % Seuls les chapitres et sections apparaissent dans la TOC

% Configuration des titres
\titleformat{\section}{\normalfont\large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\normalsize\bfseries}{\thesubsection}{1em}{}

% --- Package CircuiTikz avec configuration spéciale ---
\usepackage{tikz}                   % TikZ doit être chargé avant circuitikz
\usepackage[siunitx]{circuitikz} % Configuration pour les diagrammes électriques
\usetikzlibrary{babel}

% --- Package pour inclure des images SVG ---
\usepackage{svg}
\usepackage{import}
\usepackage{xifthen}
\usepackage{pdfpages}
\usepackage{transparent}

\newcommand{\incfig}[1]{%
  \def\svgwidth{\columnwidth} % Définit la largeur (ici, largeur de la colonne)
  \import{./figures/}{#1.pdf_tex} % Importe le fichier .pdf_tex depuis le dossier 'figures'
}

% --- Style personnalisé pour les légendes des tableaux ---
% On veut : petite taille, largeur limitée à la largeur de la table,
% possibilité de plusieurs lignes et fond gris clair.
\DeclareCaptionFont{smallit}{\tiny}
% Define a caption format that places the caption text inside a colored box
% whose width is the caption width (which will be set to the table width).
% Draw a gray background with a black frame that matches the caption width.
% We account for the frame thickness (\fboxrule) and padding (\fboxsep) so the outer
% \fcolorbox total width equals the requested caption width (which is \linewidth inside
% the caption context). The inner parbox width is therefore \linewidth - 2\fboxrule - 2\fboxsep.
\DeclareCaptionFormat{graybox}{%
        {%
                % Use local settings for border thickness and padding. We'll use \arrayrulewidth
                % as the default border width for consistency with table rules.
                \setlength{\fboxrule}{\arrayrulewidth}%
                \setlength{\fboxsep}{0.5pt}% small inner padding so the gray fills to the border
                % Compute inner width; if \dimexpr is available this will evaluate safely here.
                \begingroup
                    \colorlet{captionframe}{black}% frame color
                    \colorlet{captionbg}{boxgray}% background color
                    \edef\innerwidth{\the\dimexpr\linewidth-2\fboxrule-2\fboxsep\relax}%
                    \fcolorbox{captionframe}{captionbg}{% outer framed box (total width = \linewidth)
                        \parbox{\innerwidth}{% inner box sized so outer frame equals \linewidth
                            \hspace{0.15em}#1#2#3\hspace{0.15em}% small horizontal padding
                        }% end parbox
                    }% end fcolorbox
                \endgroup
        }%
}
% Apply the format to table captions: smaller font, the graybox format,
% allow multi-line captions and left-aligned wrapping. We do NOT hardcode a
% global width here because \linewidth at package load time is the text width,
% not the float width. Instead, ensure that at the start of every table float
% we set the caption width to the current \linewidth (i.e. the table width).
% Reduce the vertical gap between table and caption and force label on its own line
% ONLY FOR TABLES (not figures)
\captionsetup[table]{format=graybox,font=smallit,labelfont=bf,justification=raggedright,singlelinecheck=false,margin=0pt,labelsep=newline,skip=0pt}
% When entering a table environment, set caption width to the current \linewidth
% so the caption box will match the table's width.
\AtBeginEnvironment{table}{\captionsetup{width=\linewidth}}

% --- Nouvel environnement 'tableau' pour tableaux sans style spécial ---
% Création d'un nouvel environnement flottant nommé 'tableau'
\DeclareFloatingEnvironment[
    fileext=lot,        % Utilise la même liste que les tables
    listname={Liste des tableaux},
    name=Tableau,
    placement=tbp,      % Placement par défaut : top, bottom, page
    within=none         % Numérotation continue dans tout le document
]{tableau}

% Configuration du caption pour l'environnement 'tableau' : style simple, sans boîte grise
\captionsetup[tableau]{
    format=plain,           % Format simple sans boîte
    font=small,             % Taille de police normale (pas tiny)
    labelfont=bf,           % Label en gras
    justification=centering, % Centré
    singlelinecheck=true,   % Permet le centrage automatique pour les légendes courtes
    margin=0pt,
    labelsep=colon,         % Séparateur standard "Tableau X:"
    skip=10pt               % Espacement normal entre tableau et caption
}

% Optional helper environment: tablebox
% Usage: \begin{table}\begin{tablebox}{<width>} ... \end{tablebox}\end{table}
% This wraps content in a minipage so that \linewidth inside equals <width>
\newenvironment{tablebox}[1][\linewidth]{%
    \begin{minipage}{#1}
}{%
    \end{minipage}
}
\usepackage{booktabs}               % Pour de jolis tableaux
% Allow tables that stretch to a target width
\usepackage{tabularx}
\usepackage{array}
% Right-aligned X column for tabularx
\newcolumntype{R}{>{\raggedleft\arraybackslash}X}
\usepackage{titlesec}               % Pour personnaliser les titres de chapitres
\usepackage{lastpage}               % Pour obtenir le nombre total de pages
\usepackage{datetime}               % Pour le formatage des dates
\usepackage{pgfplots}
% Ensure pgfplots uses modern compatibility level to avoid backward-compatibility warnings
\pgfplotsset{compat=1.18}

% Package for placing content absolutely on the page background/foreground
\usepackage{eso-pic}

% --- Package CircuiTikz avec configuration spéciale ---
\usepackage{tikz}                   % TikZ doit être chargé avant circuitikz
\usepackage[siunitx]{circuitikz} % Configuration pour les diagrammes électriques
\usetikzlibrary{babel, positioning, shapes, arrows, patterns} % Bibliothèques TikZ supplémentaires

% --- Définition des couleurs personnalisées ---
\definecolor{INSAbleu}{RGB}{0, 70, 127}
\definecolor{INSArouge}{RGB}{229, 39, 19}
\definecolor{boxgray}{gray}{0.95}
\definecolor{remindercolor}{RGB}{96, 98, 103}     % Bleu clair pour les rappels
\definecolor{conclusioncolor}{RGB}{255, 58, 24}    % Rouge pour les conclusions
\definecolor{conclusionbg}{RGB}{255, 240, 240}     % Fond rouge très clair
\definecolor{BLANC}{RGB}{255, 255, 255}            % Couleur blanche pour le pied de page

% --- Définition des modèles de boîtes colorées ---
\newtcolorbox{reminderbox}[1][Rappel]{
    colback=remindercolor!20,
    colframe=remindercolor!80,
    coltitle=white,
    colbacktitle=remindercolor!80,
    title=#1,
    fonttitle=\bfseries,
    rounded corners,
    boxrule=1pt,
    left=3mm,
    right=3mm,
    top=2mm,
    bottom=2mm
}

\newtcolorbox{conclusionbox}[1][Conclusion]{
    colback=conclusionbg,
    colframe=conclusioncolor,
    coltitle=white,
    colbacktitle=conclusioncolor,
    title=#1,
    fonttitle=\bfseries,
    rounded corners,
    boxrule=1pt,
    left=3mm,
    right=3mm,
    top=2mm,
    bottom=2mm
}

\newtcolorbox{infobox}[1][Information]{
    colback=INSAbleu!10,
    colframe=INSAbleu,
    coltitle=white,
    colbacktitle=INSAbleu,
    title=#1,
    fonttitle=\bfseries,
    rounded corners,
    boxrule=1pt,
    left=3mm,
    right=3mm,
    top=2mm,
    bottom=2mm
}

\newtcolorbox{classicbox}[1][]{
    colback=gray!10,
    colframe=gray!50,
    coltitle=white,
    colbacktitle=gray!50,
    title=#1,
    fonttitle=\bfseries,
    rounded corners,
    boxrule=1pt,
    left=3mm,
    right=3mm,
    top=2mm,
    bottom=2mm
}

% --- Commande pour référencer les fichiers de simulation dans le pied de page ---
% Variable pour stocker les références de la page courante
\newcommand{\figfooter}{}
% Commande pour ajouter une référence
\makeatletter
\newcommand{\figref}[2]{%
    \ifx\figfooter\empty
        \gdef\figfooter{\tiny{$\blacktriangleright$ \textbf{#1:} \texttt{#2}}}%
    \else
        \xdef\figfooter{\unexpanded\expandafter{\figfooter}\\[2pt]\noexpand\tiny{$\blacktriangleright$ \noexpand\textbf{#1:} \noexpand\texttt{#2}}}%
    \fi
}
\makeatother
% Commande pour réinitialiser les références (appelée automatiquement)
\newcommand{\clearfigfooter}{\gdef\figfooter{}}